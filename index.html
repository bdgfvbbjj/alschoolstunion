<!DOCTYPE html>
<html>
<head>
  <title>Регистрация в Telegram</title>
</head>
<body>
<h2>Регистрация студента</h2>
<p>Подождите, идёт проверка IP...</p>

<script>
function initWebApp() {
    // Проверяем наличие WebApp
    if (!window.Telegram?.WebApp) {
        document.body.innerHTML = "<p>Откройте эту страницу через Telegram Web App!</p>";
        return;
    }

    // Уведомляем Telegram, что страница готова
    window.Telegram.WebApp.ready();

    // Получаем IP через API
    fetch("https://api.ipify.org?format=json")
        .then(res => res.json())
        .then(data => {
            const ip = data.ip;
            // Отправляем IP боту
            window.Telegram.WebApp.sendData(ip);
            // Закрываем Web App
            window.Telegram.WebApp.close();
        })
        .catch(err => {
            console.error(err);
            document.body.innerHTML = "<p>Ошибка при получении IP. Попробуйте ещё раз.</p>";
        });
}

// Ждём полной загрузки страницы
window.addEventListener("DOMContentLoaded", initWebApp);
</script>
</body>
</html>
